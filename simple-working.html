<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>DSA Learner — Working Version</title>
    <link rel="icon" href="favicon.svg" type="image/svg+xml" />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header class="app-header">
      <div class="brand">DSA Learner</div>
      <div class="header-actions">
        <button id="startPathBtn" class="ghost">Start Path</button>
        <button id="reviewQueueBtn" class="ghost">Review Queue</button>
        <button id="labBtn" class="ghost" title="Open DSA Lab">Lab</button>
        <button id="resetProgressBtn" class="danger ghost" title="Clear local progress">Reset</button>
      </div>
    </header>

    <div class="app">
      <aside class="sidebar" id="sidebar"></aside>
      <main class="main" id="main"></main>
      <aside class="coach" id="coach"></aside>
    </div>

    <footer class="footer">
      <div>Built for rapid, neuroscience-informed DSA mastery.</div>
      <div><a href="#" id="aboutLink">About</a></div>
    </footer>

    <script>
      // Inline the content data to avoid module loading issues
      const sampleContent = {
        topics: [
          {
            id: 'arrays',
            title: 'Arrays & Two Pointers',
            summary: 'Master array manipulation and two-pointer techniques',
            items: [
              {
                id: 'two-sum',
                title: 'Two Sum (Sorted Array)',
                difficulty: 'easy',
                brief: 'Find two numbers that add up to a target in a sorted array'
              },
              {
                id: 'three-sum',
                title: 'Three Sum',
                difficulty: 'medium', 
                brief: 'Find all unique triplets that sum to zero'
              },
              {
                id: 'container-water',
                title: 'Container With Most Water',
                difficulty: 'medium',
                brief: 'Find two lines that together form a container with most water'
              }
            ]
          },
          {
            id: 'sorting',
            title: 'Sorting & Searching',
            summary: 'Fundamental sorting algorithms and binary search',
            items: [
              {
                id: 'binary-search',
                title: 'Binary Search',
                difficulty: 'easy',
                brief: 'Search for a target in a sorted array in O(log n) time'
              },
              {
                id: 'merge-sort',
                title: 'Merge Sort',
                difficulty: 'medium',
                brief: 'Divide and conquer sorting algorithm'
              }
            ]
          },
          {
            id: 'dynamic-programming',
            title: 'Dynamic Programming',
            summary: 'Break down complex problems into simpler subproblems',
            items: [
              {
                id: 'fibonacci',
                title: 'Fibonacci Numbers',
                difficulty: 'easy',
                brief: 'Compute Fibonacci numbers efficiently using DP'
              },
              {
                id: 'coin-change',
                title: 'Coin Change',
                difficulty: 'medium',
                brief: 'Find minimum coins needed to make a target amount'
              },
              {
                id: 'longest-subsequence',
                title: 'Longest Increasing Subsequence',
                difficulty: 'medium',
                brief: 'Find length of longest increasing subsequence'
              }
            ]
          },
          {
            id: 'graphs',
            title: 'Graph Algorithms',
            summary: 'Traversal, shortest paths, and graph properties',
            items: [
              {
                id: 'bfs-dfs',
                title: 'BFS and DFS',
                difficulty: 'medium',
                brief: 'Breadth-first and depth-first search algorithms'
              },
              {
                id: 'dijkstra',
                title: "Dijkstra's Algorithm",
                difficulty: 'hard',
                brief: 'Find shortest paths from a source vertex'
              }
            ]
          }
        ]
      };

      // Simple state management
      const state = {
        progress: {},
        load() {
          try {
            const saved = localStorage.getItem('dsa-learner-progress');
            if (saved) {
              this.progress = JSON.parse(saved);
            }
          } catch (e) {
            console.warn('Failed to load progress');
          }
          return this;
        },
        save() {
          localStorage.setItem('dsa-learner-progress', JSON.stringify(this.progress));
        },
        reset() {
          this.progress = {};
          localStorage.removeItem('dsa-learner-progress');
        }
      };

      // Load state
      state.load();

      // DOM elements
      const sidebar = document.getElementById('sidebar');
      const main = document.getElementById('main');
      const coach = document.getElementById('coach');

      // Render functions
      function renderSidebar() {
        sidebar.innerHTML = '';
        const list = document.createElement('div');
        list.className = 'list';

        sampleContent.topics.forEach(topic => {
          const box = document.createElement('div');
          box.className = 'topic';
          box.style.cursor = 'pointer';
          
          const completedItems = topic.items.filter(item => 
            state.progress[topic.id + '-' + item.id]
          ).length;
          const progress = Math.round((completedItems / topic.items.length) * 100);

          box.innerHTML = \`
            <div class="row">
              <div><strong>\${topic.title}</strong></div>
              <div class="progress-badge">\${progress}%</div>
            </div>
            <div class="muted" style="font-size: 12px; margin-top: 4px;">
              \${topic.summary}
            </div>
            <div style="font-size: 11px; color: var(--muted); margin-top: 4px;">
              \${topic.items.length} items • \${completedItems} completed
            </div>
          \`;

          box.onclick = () => renderTopic(topic);
          list.appendChild(box);
        });

        sidebar.appendChild(list);
      }

      function renderTopic(topic) {
        main.innerHTML = '';

        const header = document.createElement('div');
        header.className = 'section';
        header.innerHTML = \`
          <h2>\${topic.title}</h2>
          <div class="muted">\${topic.summary}</div>
          <div style="margin-top: 12px;">
            <span style="background: var(--elev); padding: 4px 8px; border-radius: 4px;">
              \${topic.items.length} items
            </span>
          </div>
        \`;
        main.appendChild(header);

        const itemsGrid = document.createElement('div');
        itemsGrid.className = 'grid cols-2';
        itemsGrid.style.gap = '12px';
        itemsGrid.style.marginTop = '20px';

        topic.items.forEach(item => {
          const card = document.createElement('div');
          card.className = 'section';
          card.style.cursor = 'pointer';
          card.style.transition = 'all 0.2s';

          const isCompleted = state.progress[topic.id + '-' + item.id];
          const difficultyColors = {
            easy: 'var(--ok)',
            medium: 'var(--warn)',
            hard: 'var(--danger)'
          };

          card.innerHTML = \`
            <div style="margin-bottom: 8px;">
              <div style="font-weight: 600; margin-bottom: 4px; display: flex; align-items: center; gap: 8px;">
                \${item.title}
                \${isCompleted ? '<span style="color: var(--ok);">✓</span>' : ''}
              </div>
              <div style="font-size: 13px; color: var(--muted); line-height: 1.4;">
                \${item.brief}
              </div>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <span style="background: \${difficultyColors[item.difficulty]}; color: var(--bg); padding: 2px 6px; border-radius: 3px; font-size: 11px;">
                \${item.difficulty}
              </span>
              <button style="background: var(--accent); color: var(--bg); border: none; padding: 4px 8px; border-radius: 3px; font-size: 11px; cursor: pointer;">
                \${isCompleted ? 'Review' : 'Start'}
              </button>
            </div>
          \`;

          card.onmouseenter = () => {
            card.style.borderColor = 'var(--accent)';
            card.style.transform = 'translateY(-1px)';
          };
          card.onmouseleave = () => {
            card.style.borderColor = 'var(--border)';
            card.style.transform = 'translateY(0)';
          };

          card.onclick = () => {
            const progressKey = topic.id + '-' + item.id;
            state.progress[progressKey] = true;
            state.save();
            
            renderTopic(topic); // Re-render to show completion
            renderSidebar(); // Update sidebar progress
            
            main.scrollTop = 0;
            
            // Show success message
            const successMsg = document.createElement('div');
            successMsg.className = 'section';
            successMsg.style.background = 'var(--ok)';
            successMsg.style.color = 'var(--bg)';
            successMsg.style.marginBottom = '12px';
            successMsg.innerHTML = \`
              <strong>🎉 Completed: \${item.title}</strong>
              <div style="font-size: 14px; margin-top: 4px;">
                Great job! This item is now marked as complete.
              </div>
            \`;
            main.insertBefore(successMsg, main.firstChild);
            
            setTimeout(() => successMsg.remove(), 3000);
          };

          itemsGrid.appendChild(card);
        });

        main.appendChild(itemsGrid);
      }

      function renderCoach() {
        const totalItems = sampleContent.topics.reduce((sum, topic) => sum + topic.items.length, 0);
        const completedItems = Object.keys(state.progress).length;
        const overallProgress = Math.round((completedItems / totalItems) * 100);

        coach.innerHTML = \`
          <div class="section">
            <h3>🤖 AI Coach</h3>
            <p style="font-size: 14px; color: var(--muted);">
              Welcome to DSA Learner! Click on topics and items to start learning.
            </p>
          </div>
          <div class="section">
            <h4>Progress Overview</h4>
            <div style="font-size: 13px; line-height: 1.6;">
              <div>📚 Topics: \${sampleContent.topics.length}</div>
              <div>📝 Total Items: \${totalItems}</div>
              <div>✅ Completed: \${completedItems}</div>
              <div>🎯 Progress: \${overallProgress}%</div>
            </div>
            <div style="background: var(--elev); height: 8px; border-radius: 4px; margin-top: 8px; overflow: hidden;">
              <div style="background: var(--accent); height: 100%; width: \${overallProgress}%; transition: width 0.3s;"></div>
            </div>
          </div>
          <div class="section">
            <h4>Quick Actions</h4>
            <button onclick="state.reset(); location.reload();" style="background: var(--danger); color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 12px;">
              Reset Progress
            </button>
          </div>
        \`;
      }

      // Initialize
      function init() {
        renderSidebar();
        renderCoach();
        
        // Default to first topic
        if (sampleContent.topics.length > 0) {
          renderTopic(sampleContent.topics[0]);
        }
        
        console.log('🎉 DSA Learner initialized successfully!');
      }

      // Start the app
      init();
    </script>
  </body>
</html>