<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>DSA Learner — Complete Edition</title>
    <link rel="icon" href="favicon.svg" type="image/svg+xml" />
    <link rel="stylesheet" href="styles.css" />
    
    <!-- CodeMirror for code editing -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/monokai.min.css">
    
    <style>
        /* Enhanced styles for full functionality */
        .learning-mode {
            display: none;
            padding: 20px;
        }
        
        .learning-mode.active {
            display: block;
        }
        
        .mode-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--border);
        }
        
        .mode-tab {
            padding: 10px 20px;
            background: transparent;
            border: none;
            color: var(--text);
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
        }
        
        .mode-tab.active {
            color: var(--accent);
            border-bottom-color: var(--accent);
        }
        
        .mode-tab:hover {
            background: var(--elev);
        }
        
        /* Learn Section */
        .learn-section {
            background: var(--elev);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .learn-section h3 {
            color: var(--accent);
            margin-top: 0;
        }
        
        .code-template {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            overflow-x: auto;
            position: relative;
        }
        
        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 5px 10px;
            background: var(--accent);
            color: var(--bg);
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .copy-btn:hover {
            opacity: 0.8;
        }
        
        /* Quiz Section */
        .quiz-question {
            background: var(--elev);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .quiz-choices {
            margin: 15px 0;
        }
        
        .quiz-choice {
            display: block;
            width: 100%;
            text-align: left;
            padding: 12px;
            margin: 8px 0;
            background: var(--bg);
            border: 2px solid var(--border);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .quiz-choice:hover {
            border-color: var(--accent);
            transform: translateX(5px);
        }
        
        .quiz-choice.selected {
            background: rgba(100, 200, 100, 0.1);
            border-color: var(--ok);
        }
        
        .quiz-choice.correct {
            background: rgba(100, 200, 100, 0.2);
            border-color: var(--ok);
        }
        
        .quiz-choice.incorrect {
            background: rgba(200, 100, 100, 0.2);
            border-color: var(--danger);
        }
        
        .quiz-explanation {
            margin-top: 15px;
            padding: 15px;
            background: rgba(100, 150, 200, 0.1);
            border-radius: 6px;
            display: none;
        }
        
        .quiz-explanation.show {
            display: block;
        }
        
        /* Practice Section */
        .practice-editor {
            height: 300px;
            border: 1px solid var(--border);
            border-radius: 4px;
            margin: 20px 0;
        }
        
        .CodeMirror {
            height: 100%;
            font-size: 14px;
        }
        
        .test-cases {
            background: var(--elev);
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
        }
        
        .test-case {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            margin: 8px 0;
            background: var(--bg);
            border-radius: 4px;
            font-family: monospace;
            font-size: 13px;
        }
        
        .test-case.pass {
            background: rgba(100, 200, 100, 0.1);
            border-left: 4px solid var(--ok);
        }
        
        .test-case.fail {
            background: rgba(200, 100, 100, 0.1);
            border-left: 4px solid var(--danger);
        }
        
        .run-btn {
            padding: 12px 24px;
            background: var(--accent);
            color: var(--bg);
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            margin-right: 10px;
        }
        
        .run-btn:hover {
            opacity: 0.9;
        }
        
        .run-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .output-console {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            min-height: 100px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }
        
        .output-line {
            margin: 2px 0;
        }
        
        .output-line.error {
            color: #f48771;
        }
        
        .output-line.success {
            color: #4ec9b0;
        }
        
        .output-line.info {
            color: #9cdcfe;
        }
        
        /* Progress Tracker */
        .progress-bar {
            height: 4px;
            background: var(--border);
            border-radius: 2px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), var(--ok));
            transition: width 0.3s ease;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: var(--elev);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--accent);
        }
        
        .stat-label {
            font-size: 12px;
            color: var(--muted);
            margin-top: 5px;
        }
        
        /* Hints System */
        .hints-container {
            margin: 20px 0;
        }
        
        .hint-item {
            background: rgba(255, 200, 0, 0.1);
            border-left: 4px solid var(--warn);
            padding: 12px;
            margin: 10px 0;
            border-radius: 4px;
            cursor: pointer;
            position: relative;
        }
        
        .hint-item.revealed {
            cursor: default;
        }
        
        .hint-content {
            display: none;
        }
        
        .hint-item.revealed .hint-content {
            display: block;
        }
        
        .hint-item:not(.revealed)::after {
            content: 'Click to reveal hint';
            font-size: 12px;
            color: var(--muted);
            font-style: italic;
        }
        
        /* Animation */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .animate-in {
            animation: slideIn 0.3s ease;
        }
        /* Game Styles */
        .bs-board {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            margin-top: 16px;
            padding: 12px;
            background: var(--bg-secondary);
            border-radius: 8px;
        }
        
        .bs-cell {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            transition: all 0.2s ease;
        }
        
        .bs-cell.faded {
            opacity: 0.3;
            background: var(--muted);
        }
        
        .bs-cell.target {
            background: var(--ok);
            color: white;
            animation: pulse 0.6s ease;
        }
        
        .section {
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .section > h2 {
            width: 100%;
            max-width: 800px;
            text-align: center;
        }
        
        .section > .muted {
            text-align: center;
            width: 100%;
            max-width: 800px;
        }
        
        .row {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            gap: 8px;
            margin: 8px 0;
            width: 100%;
            max-width: 800px;
        }
        
        .spacer {
            flex: 1;
        }
        
        /* Tree visualization styles */
        .viz-tree-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            margin: 20px 0;
        }
        
        .viz-tree {
            position: relative;
            width: 600px;
            height: 400px;
            margin: 0 auto;
            background: var(--bg-secondary);
            border-radius: 8px;
            overflow: visible;
        }
        
        .viz-tree-node {
            position: absolute;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--bg);
            border: 2px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            transition: all 0.3s ease;
            z-index: 2;
        }
        
        .viz-tree-node.visited {
            background: var(--ok);
            color: white;
            border-color: var(--ok);
        }
        
        .viz-tree-node.current {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
            transform: scale(1.2);
        }
        
        .viz-tree-edge {
            position: absolute;
            pointer-events: none;
            z-index: 1;
        }
        
        .viz-message {
            text-align: center;
            margin-bottom: 10px;
            font-weight: bold;
            color: var(--accent);
        }
        
        /* Array visualization styles */
        .viz-array-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            margin: 20px 0;
        }
        
        .viz-array {
            display: flex;
            gap: 4px;
            justify-content: center;
        }
        
        .viz-array-cell {
            width: 50px;
            height: 50px;
            border: 2px solid var(--border);
            background: var(--bg);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: all 0.3s ease;
        }
        
        .viz-array-cell.highlighted {
            background: var(--accent);
            color: white;
            transform: scale(1.1);
        }
        
        .viz-array-cell.pointer {
            border-color: var(--warning);
            border-width: 3px;
        }
        
        .viz-array-value {
            font-size: 18px;
            font-weight: bold;
        }
        
        .viz-array-index {
            font-size: 10px;
            color: var(--muted);
            margin-top: 2px;
        }
        
        .viz-pointer {
            font-size: 20px;
            color: var(--warning);
            margin-top: 5px;
        }
        
        /* Graph visualization styles */
        .graph-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            margin: 20px 0;
        }
        
        .graph-svg {
            width: 800px;
            height: 500px;
            background: var(--bg-secondary);
            border-radius: 8px;
            border: 2px solid var(--border);
            cursor: crosshair;
        }
        
        .graph-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .graph-node {
            fill: var(--bg);
            stroke: var(--border);
            stroke-width: 2;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .graph-node.unvisited {
            fill: var(--bg);
            stroke: var(--border);
        }
        
        .graph-node.visited {
            fill: var(--info);
            stroke: var(--info);
        }
        
        .graph-node.current {
            fill: var(--accent);
            stroke: var(--accent);
            stroke-width: 4;
            r: 22;
        }
        
        .graph-node.source {
            fill: var(--ok);
            stroke: var(--ok);
        }
        
        .graph-node.destination {
            fill: var(--warning);
            stroke: var(--warning);
        }
        
        .graph-node.in-mst {
            fill: var(--ok);
            stroke: var(--ok);
        }
        
        .graph-edge {
            stroke: var(--border);
            stroke-width: 2;
            fill: none;
            transition: all 0.3s ease;
        }
        
        .graph-edge.unprocessed {
            stroke: var(--border);
            stroke-opacity: 0.6;
        }
        
        .graph-edge.processing {
            stroke: var(--warning);
            stroke-width: 4;
            animation: pulse-edge 1s infinite;
        }
        
        .graph-edge.selected {
            stroke: var(--accent);
            stroke-width: 4;
        }
        
        .graph-edge.mst {
            stroke: var(--ok);
            stroke-width: 4;
        }
        
        .graph-edge.rejected {
            stroke: var(--error);
            stroke-width: 2;
            stroke-dasharray: 5,5;
            stroke-opacity: 0.7;
        }
        
        .graph-edge.shortest-path {
            stroke: var(--warning);
            stroke-width: 6;
            filter: drop-shadow(0 0 4px var(--warning));
        }
        
        .graph-node-label {
            font-family: 'Inter', sans-serif;
            font-weight: bold;
            font-size: 14px;
            fill: white;
            text-anchor: middle;
            dominant-baseline: central;
            pointer-events: none;
        }
        
        .graph-edge-label {
            font-family: 'Inter', sans-serif;
            font-size: 12px;
            fill: var(--text);
            text-anchor: middle;
            dominant-baseline: central;
            font-weight: bold;
            pointer-events: none;
        }
        
        .graph-distance-label {
            font-family: 'Inter', sans-serif;
            font-size: 10px;
            fill: var(--accent);
            text-anchor: middle;
            font-weight: bold;
        }
        
        .distance-table {
            margin-top: 15px;
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }
        
        .distance-entry {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 8px 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 60px;
        }
        
        .distance-entry.updated {
            background: var(--accent);
            color: white;
            animation: flash 0.5s ease;
        }
        
        .distance-node {
            font-weight: bold;
            font-size: 14px;
        }
        
        .distance-value {
            font-size: 12px;
            color: var(--muted);
            margin-top: 2px;
        }
        
        .distance-entry.updated .distance-value {
            color: white;
        }
        
        .priority-queue {
            margin-top: 15px;
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 15px;
        }
        
        .queue-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--accent);
        }
        
        .queue-items {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .queue-item {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 6px 10px;
            font-size: 12px;
            font-family: 'Fira Code', monospace;
        }
        
        .queue-item.processing {
            background: var(--warning);
            color: white;
        }
        
        @keyframes pulse-edge {
            0%, 100% { stroke-opacity: 0.8; }
            50% { stroke-opacity: 1; stroke-width: 5; }
        }
        
        @keyframes flash {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        /* Matrix visualization for Floyd-Warshall */
        .matrix-container {
            margin: 20px 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .matrix-table {
            border-collapse: collapse;
            background: var(--bg-secondary);
            border-radius: 8px;
            overflow: hidden;
        }
        
        .matrix-cell {
            border: 1px solid var(--border);
            padding: 8px 12px;
            text-align: center;
            font-family: 'Fira Code', monospace;
            font-size: 12px;
            min-width: 40px;
            transition: all 0.3s ease;
        }
        
        .matrix-cell.header {
            background: var(--accent);
            color: white;
            font-weight: bold;
        }
        
        .matrix-cell.updated {
            background: var(--warning);
            color: white;
            animation: flash 0.5s ease;
        }
        
        .matrix-cell.considering {
            background: var(--info);
            color: white;
        }
        
        .grid-board {
            display: grid;
            grid-template-columns: repeat(var(--cols, 25), 20px);
            grid-template-rows: repeat(var(--rows, 15), 20px);
            gap: 1px;
            padding: 12px;
            background: var(--bg-secondary);
            border-radius: 8px;
            margin: 16px auto 0 auto;
            width: fit-content;
            max-width: none;
        }
        
        .grid-board .cell {
            background: var(--bg);
            border: 1px solid var(--border);
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
        }
        
        .grid-board .cell.wall {
            background: var(--text);
        }
        
        .grid-board .cell.start {
            background: var(--ok);
        }
        
        .grid-board .cell.end {
            background: var(--accent);
        }
        
        .grid-board .cell.visited {
            background: var(--info);
            opacity: 0.6;
        }
        
        .grid-board .cell.path {
            background: var(--warning);
            animation: pathReveal 0.3s ease;
        }

        .grid-board .cell.current {
            background: var(--error);
            animation: pulse 0.5s infinite;
        }

        .grid-board .cell.backtrack {
            background: #9c27b0;
            opacity: 0.7;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        @keyframes pathReveal {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        
        .pill {
            display: inline-block;
            padding: 4px 12px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .spacer {
            flex: 1;
        }
        
        .row {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .ghost {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text);
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .ghost:hover {
            background: var(--bg-secondary);
        }
        
        .btn.secondary {
            background: var(--bg-secondary);
            color: var(--text);
            border: 1px solid var(--border);
        }
        
        .btn.secondary:hover {
            background: var(--border);
        }
        
        /* Visualizer Styles */
        .visualizer-container {
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .viz-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .viz-btn {
            padding: 8px 16px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s;
        }
        
        .viz-btn:hover {
            background: var(--accent-2);
        }
        
        .viz-step-info {
            margin-left: 20px;
            padding: 8px 16px;
            background: var(--bg);
            border-radius: 4px;
            font-size: 14px;
        }
        
        .viz-speed {
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
        }
        
        .viz-main {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        
        .viz-display {
            background: var(--bg);
            border-radius: 8px;
            padding: 20px;
            min-height: 300px;
            position: relative;
        }
        
        .viz-explanation {
            background: var(--bg);
            border-radius: 8px;
            padding: 20px;
        }
        
        .viz-explanation h4 {
            margin-top: 0;
            color: var(--accent);
        }
        
        .viz-code {
            background: var(--bg);
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .viz-code-block {
            background: #1e1e1e;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 13px;
            line-height: 1.5;
        }
        
        .code-line {
            display: block;
            padding: 2px 0;
        }
        
        .code-line.highlighted {
            background: rgba(74, 158, 255, 0.2);
            border-left: 3px solid var(--accent);
            padding-left: 10px;
            margin-left: -10px;
        }
        
        /* Array Visualization */
        .viz-array-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        
        .viz-message {
            font-size: 16px;
            font-weight: 500;
            color: var(--accent);
            text-align: center;
        }
        
        .viz-array {
            display: flex;
            gap: 4px;
        }
        
        .viz-array-cell {
            width: 50px;
            height: 60px;
            border: 2px solid var(--border);
            border-radius: 4px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            background: var(--bg-secondary);
            transition: all 0.3s ease;
        }
        
        .viz-array-cell.highlighted {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
            transform: scale(1.1);
        }
        
        .viz-array-cell.pointer {
            border-color: var(--warning);
            border-width: 3px;
        }
        
        .viz-array-cell.in-window {
            background: rgba(74, 158, 255, 0.3);
            border-color: var(--accent);
        }
        
        .viz-array-cell.removing {
            background: rgba(244, 67, 54, 0.3);
            border-color: var(--error);
        }
        
        .viz-array-cell.adding {
            background: rgba(76, 175, 80, 0.3);
            border-color: var(--ok);
        }
        
        .viz-array-cell.out-of-range {
            opacity: 0.3;
        }
        
        .viz-array-cell.checking {
            background: var(--warning);
            color: white;
            animation: pulse 0.5s;
        }
        
        .viz-array-cell.found {
            background: var(--ok);
            color: white;
            animation: pulse 0.5s;
        }
        
        .viz-array-cell.eliminating {
            background: rgba(244, 67, 54, 0.2);
            text-decoration: line-through;
        }
        
        .viz-array-value {
            font-size: 18px;
            font-weight: bold;
        }
        
        .viz-array-index {
            font-size: 12px;
            color: var(--muted);
            margin-top: 4px;
        }
        
        .viz-pointer-label {
            position: absolute;
            bottom: -25px;
            font-size: 14px;
            font-weight: bold;
            color: var(--warning);
        }
        
        .viz-action-label {
            position: absolute;
            top: -25px;
            font-size: 20px;
            font-weight: bold;
        }
        
        .viz-boundary-label {
            position: absolute;
            bottom: -25px;
            font-size: 14px;
            font-weight: bold;
            color: var(--info);
        }
        
        .viz-mid-label {
            position: absolute;
            bottom: -25px;
            font-size: 14px;
            font-weight: bold;
            color: var(--warning);
        }
        
        /* Tree Visualization */
        .viz-tree-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        
        .viz-tree {
            position: relative;
            width: 100%;
            height: 400px;
        }
        
        .viz-tree-node {
            position: absolute;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--info);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            z-index: 2;
            transition: all 0.3s ease;
        }
        
        .viz-tree-node.visited {
            background: var(--ok);
        }
        
        .viz-tree-node.current {
            background: var(--warning);
            transform: scale(1.2);
            box-shadow: 0 0 20px rgba(255, 152, 0, 0.5);
        }
        
        .viz-tree-edge {
            position: absolute;
            z-index: 1;
        }
        
        /* Sorting Visualization */
        .viz-sort-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        
        .viz-bars {
            display: flex;
            align-items: flex-end;
            gap: 4px;
            height: 250px;
        }
        
        .viz-bar {
            width: 40px;
            background: linear-gradient(180deg, var(--accent), var(--accent-2));
            border-radius: 4px 4px 0 0;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            padding-bottom: 5px;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .viz-bar.comparing {
            background: linear-gradient(180deg, var(--warning), #ff6b00);
        }
        
        .viz-bar.swapped {
            background: linear-gradient(180deg, var(--ok), #2e7d32);
            animation: swap 0.3s;
        }
        
        .viz-bar-value {
            color: white;
            font-size: 12px;
            font-weight: bold;
        }
        
        @keyframes swap {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        /* DP Table Visualization */
        .viz-dp-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        
        .viz-dp-table {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }
        
        .viz-dp-row {
            display: flex;
            gap: 2px;
        }
        
        .viz-dp-cell {
            width: 60px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .viz-dp-cell.header {
            background: var(--border);
            font-size: 12px;
            color: var(--muted);
        }
        
        .viz-dp-cell.highlighted {
            background: var(--accent);
            color: white;
            transform: scale(1.1);
        }
        
        .viz-dp-cell.empty {
            color: var(--muted);
        }
        
        /* Graph Visualization */
        .viz-graph-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        
        .viz-graph {
            background: var(--bg);
            border-radius: 8px;
        }
        
        .viz-graph-node {
            transition: all 0.3s ease;
        }
        
        .viz-graph-node.in-stack {
            stroke: var(--warning) !important;
            stroke-width: 4px !important;
        }
        
        /* Lab Styles */
        .grid.cols-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .code.editor {
            width: 100%;
            background: var(--bg);
            border: 1px solid var(--border);
            color: var(--text);
            padding: 10px;
            border-radius: 4px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 13px;
            resize: vertical;
        }
        
        .danger-text {
            color: var(--error);
            padding: 10px;
            background: rgba(244, 67, 54, 0.1);
            border-radius: 4px;
        }
        
        input[type="text"] {
            width: 100%;
            padding: 8px;
            background: var(--bg);
            border: 1px solid var(--border);
            color: var(--text);
            border-radius: 4px;
            margin-top: 5px;
        }
        
        select {
            padding: 8px;
            background: var(--bg);
            border: 1px solid var(--border);
            color: var(--text);
            border-radius: 4px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <header class="app-header">
        <div class="brand">DSA Learner</div>
        <div class="header-actions">
            <button id="startPathBtn" class="ghost">Start Path</button>
            <button id="reviewQueueBtn" class="ghost">Review Queue</button>
            <button id="labBtn" class="ghost" title="Open DSA Lab">Lab</button>
            <button id="resetProgressBtn" class="danger ghost" title="Clear local progress">Reset</button>
        </div>
    </header>

    <div class="app">
        <aside class="sidebar" id="sidebar">
            <div style="padding: 10px;">
                <div id="sidebar-content">Loading topics...</div>
            </div>
        </aside>
        
        <main class="main" id="main">
            <div id="welcome-screen" style="padding: 20px; text-align: center;">
                <h1>Welcome to DSA Learner</h1>
                <p>Select a topic from the sidebar to begin your journey!</p>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="stat-topics">0</div>
                        <div class="stat-label">Topics</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-problems">0</div>
                        <div class="stat-label">Problems</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-completed">0</div>
                        <div class="stat-label">Completed</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-progress">0%</div>
                        <div class="stat-label">Progress</div>
                    </div>
                </div>
            </div>
            
            <div id="problem-view" style="display: none; padding: 20px;">
                <!-- Problem content will be inserted here -->
            </div>
        </main>
        
        <aside class="coach" id="coach">
            <div style="padding: 15px;">
                <h3>🤖 AI Coach</h3>
                <div id="coach-content">
                    <p style="font-size: 14px; color: var(--muted);">
                        Ready to help you master DSA!
                    </p>
                </div>
            </div>
        </aside>
    </div>

    <footer class="footer">
        <div>Built for rapid, neuroscience-informed DSA mastery.</div>
        <div><a href="#" id="aboutLink">About</a></div>
    </footer>

    <!-- CodeMirror -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/javascript/javascript.min.js"></script>
    
    <!-- Load content module -->
    <script type="module">
        import { fullContent } from './src/modules/content-complete.js';
        
        // Make fullContent globally available
        window.fullContent = fullContent;
        
        // State management
        const state = {
            currentTopic: null,
            currentProblem: null,
            progress: JSON.parse(localStorage.getItem('dsa-progress') || '{}'),
            currentMode: 'learn'
        };
        
        // Make state globally available
        window.state = state;
        
        // Save progress
        function saveProgress() {
            localStorage.setItem('dsa-progress', JSON.stringify(state.progress));
            updateStats();
        }
        
        // Mark problem as completed
        function markCompleted(topicId, problemId) {
            const key = `${topicId}-${problemId}`;
            state.progress[key] = {
                completed: true,
                timestamp: Date.now()
            };
            saveProgress();
        }
        
        // Update statistics
        function updateStats() {
            const totalProblems = fullContent.topics.reduce((sum, t) => sum + t.items.length, 0);
            const completedProblems = Object.keys(state.progress).filter(k => state.progress[k].completed).length;
            const progress = Math.round((completedProblems / totalProblems) * 100);
            
            document.getElementById('stat-topics').textContent = fullContent.topics.length;
            document.getElementById('stat-problems').textContent = totalProblems;
            document.getElementById('stat-completed').textContent = completedProblems;
            document.getElementById('stat-progress').textContent = progress + '%';
        }
        
        // Render sidebar
        function renderSidebar() {
            const sidebar = document.getElementById('sidebar-content');
            
            if (!fullContent || !fullContent.topics) {
                sidebar.innerHTML = '<p style="color: var(--error);">Error: Content not loaded</p>';
                return;
            }
            
            sidebar.innerHTML = '';
            
            fullContent.topics.forEach(topic => {
                const topicDiv = document.createElement('div');
                topicDiv.className = 'topic';
                topicDiv.style.cssText = 'margin: 10px 0; padding: 12px; background: var(--elev); border-radius: 6px; cursor: pointer;';
                
                const completedCount = topic.items.filter(item => 
                    state.progress[`${topic.id}-${item.id}`]?.completed
                ).length;
                
                const progress = Math.round((completedCount / topic.items.length) * 100);
                
                topicDiv.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <strong>${topic.title}</strong>
                        <span style="background: var(--accent); color: var(--bg); padding: 2px 8px; border-radius: 12px; font-size: 12px;">
                            ${progress}%
                        </span>
                    </div>
                    <div style="font-size: 12px; color: var(--muted); margin-top: 4px;">
                        ${topic.summary}
                    </div>
                    <div style="font-size: 11px; color: var(--text); margin-top: 4px;">
                        ${completedCount}/${topic.items.length} completed
                    </div>
                    <div class="progress-bar" style="margin-top: 8px;">
                        <div class="progress-fill" style="width: ${progress}%"></div>
                    </div>
                `;
                
                topicDiv.onclick = () => renderTopic(topic);
                sidebar.appendChild(topicDiv);
            });
        }
        
        // Render topic view
        function renderTopic(topic) {
            state.currentTopic = topic;
            document.getElementById('welcome-screen').style.display = 'none';
            document.getElementById('problem-view').style.display = 'block';
            
            const problemView = document.getElementById('problem-view');
            problemView.innerHTML = `
                <h2>${topic.title}</h2>
                <p>${topic.summary}</p>
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px; margin-top: 20px;">
                    ${topic.items.map(item => {
                        const isCompleted = state.progress[`${topic.id}-${item.id}`]?.completed;
                        const difficultyColor = 
                            item.difficulty === 'easy' ? 'var(--ok)' :
                            item.difficulty === 'medium' ? 'var(--warn)' :
                            'var(--danger)';
                        
                        return `
                            <div class="problem-card animate-in" style="
                                padding: 15px;
                                background: var(--elev);
                                border: 2px solid ${isCompleted ? 'var(--ok)' : 'var(--border)'};
                                border-radius: 8px;
                                cursor: pointer;
                                transition: all 0.2s;
                            " onclick="window.renderProblem('${topic.id}', '${item.id}')">
                                <div style="display: flex; justify-content: space-between; align-items: start;">
                                    <strong>${item.title}</strong>
                                    ${isCompleted ? '<span style="color: var(--ok);">✓</span>' : ''}
                                </div>
                                <div style="margin: 8px 0;">
                                    <span style="
                                        padding: 2px 6px;
                                        background: ${difficultyColor};
                                        color: var(--bg);
                                        border-radius: 3px;
                                        font-size: 11px;
                                    ">${item.difficulty}</span>
                                    ${item.game ? '<span style="margin-left: 5px; padding: 2px 6px; background: var(--accent); color: var(--bg); border-radius: 3px; font-size: 11px;">🎮 Interactive</span>' : ''}
                                </div>
                                <p style="font-size: 13px; color: var(--muted); margin-top: 8px;">
                                    ${item.brief}
                                </p>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }
        
        // Render problem detail view
        window.renderProblem = function(topicId, problemId) {
            const topic = fullContent.topics.find(t => t.id === topicId);
            const problem = topic.items.find(i => i.id === problemId);
            state.currentProblem = problem;
            
            const problemView = document.getElementById('problem-view');
            problemView.innerHTML = `
                <div style="margin-bottom: 20px;">
                    <button onclick="window.renderTopic('${topicId}')" style="
                        padding: 8px 16px;
                        background: var(--border);
                        border: none;
                        border-radius: 4px;
                        color: var(--text);
                        cursor: pointer;
                    ">← Back to ${topic.title}</button>
                </div>
                
                <h2>${problem.title}</h2>
                <p>${problem.brief}</p>
                
                <div class="mode-tabs">
                    <button class="mode-tab active" onclick="window.switchMode('learn')">
                        📚 Learn
                    </button>
                    <button class="mode-tab" onclick="window.switchMode('quiz')">
                        🎯 Quiz
                    </button>
                    <button class="mode-tab" onclick="window.switchMode('practice')">
                        💻 Practice
                    </button>
                    ${problem.game ? '<button class="mode-tab" onclick="window.switchMode(\'game\')">🎮 Play</button>' : ''}
                </div>
                
                <div id="mode-content">
                    ${renderLearnMode(problem)}
                </div>
            `;
        };
        
        // Switch between modes
        window.switchMode = function(mode) {
            state.currentMode = mode;
            
            // Update tab styles
            document.querySelectorAll('.mode-tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.textContent.toLowerCase().includes(mode)) {
                    tab.classList.add('active');
                }
            });
            
            // Render mode content
            const content = document.getElementById('mode-content');
            switch(mode) {
                case 'learn':
                    content.innerHTML = renderLearnMode(state.currentProblem);
                    break;
                case 'quiz':
                    content.innerHTML = renderQuizMode(state.currentProblem);
                    break;
                case 'practice':
                    content.innerHTML = renderPracticeMode(state.currentProblem);
                    initializeCodeEditor();
                    break;
                case 'game':
                    content.innerHTML = ''; // Clear content first
                    renderGameMode(state.currentProblem, content);
                    break;
            }
        };
        
        // Render Learn Mode
        function renderLearnMode(problem) {
            if (!problem.learn) return '<p>No learning content available.</p>';
            
            return `
                <div class="learning-mode active">
                    ${problem.hints && problem.hints.length > 0 ? `
                        <div class="hints-container">
                            <h3>💡 Hints</h3>
                            ${problem.hints.map((hint, i) => `
                                <div class="hint-item" onclick="this.classList.add('revealed')">
                                    <div class="hint-content">
                                        ${hint}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                    
                    <div class="learn-section">
                        <h3>🧠 Intuition</h3>
                        <p>${problem.learn.intuition || 'No intuition provided.'}</p>
                    </div>
                    
                    <div class="learn-section">
                        <h3>👁️ Visual Explanation</h3>
                        <p>${problem.learn.visual || 'No visual explanation provided.'}</p>
                        <div id="algorithm-visualizer"></div>
                        <button class="run-btn" onclick="window.showVisualization('${problem.id}')" style="margin-top: 15px;">
                            🎬 Show Algorithm Visualization
                        </button>
                    </div>
                    
                    <div class="learn-section">
                        <h3>🎯 Pattern</h3>
                        <p>${problem.learn.pattern || 'No pattern provided.'}</p>
                    </div>
                    
                    ${problem.learn.template ? `
                        <div class="learn-section">
                            <h3>📝 Code Template</h3>
                            <div class="code-template">
                                <button class="copy-btn" onclick="navigator.clipboard.writeText(this.nextElementSibling.textContent)">
                                    Copy
                                </button>
                                <pre>${problem.learn.template}</pre>
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
        }
        
        // Render Quiz Mode
        function renderQuizMode(problem) {
            if (!problem.quiz || problem.quiz.length === 0) {
                return '<p>No quiz available for this problem.</p>';
            }
            
            return `
                <div class="learning-mode active">
                    ${problem.quiz.map((q, i) => `
                        <div class="quiz-question">
                            <h4>Question ${i + 1}: ${q.prompt}</h4>
                            ${q.type === 'mc' ? `
                                <div class="quiz-choices">
                                    ${q.choices.map((choice, j) => `
                                        <button class="quiz-choice" onclick="window.checkAnswer(${i}, ${j}, ${q.answer})">
                                            ${choice}
                                        </button>
                                    `).join('')}
                                </div>
                            ` : `
                                <input type="text" id="quiz-input-${i}" style="
                                    width: 100%;
                                    padding: 10px;
                                    background: var(--bg);
                                    border: 1px solid var(--border);
                                    border-radius: 4px;
                                    color: var(--text);
                                " placeholder="Type your answer...">
                                <button onclick="window.checkShortAnswer(${i}, '${q.accept.join('|')}')" style="
                                    margin-top: 10px;
                                    padding: 8px 16px;
                                    background: var(--accent);
                                    color: var(--bg);
                                    border: none;
                                    border-radius: 4px;
                                    cursor: pointer;
                                ">Check Answer</button>
                            `}
                            <div class="quiz-explanation" id="explanation-${i}">
                                <strong>Explanation:</strong> ${q.explain}
                            </div>
                        </div>
                    `).join('')}
                    
                    <button onclick="window.markCompleted('${state.currentTopic.id}', '${problem.id}')" class="run-btn" style="margin-top: 20px;">
                        Mark as Completed
                    </button>
                </div>
            `;
        }
        
        // Check quiz answer
        window.checkAnswer = function(questionIndex, selectedIndex, correctIndex) {
            const choices = document.querySelectorAll(`.quiz-question:nth-child(${questionIndex + 1}) .quiz-choice`);
            choices.forEach((choice, i) => {
                if (i === selectedIndex) {
                    choice.classList.add('selected');
                }
                if (i === correctIndex) {
                    choice.classList.add('correct');
                } else if (i === selectedIndex) {
                    choice.classList.add('incorrect');
                }
                choice.disabled = true;
            });
            
            document.getElementById(`explanation-${questionIndex}`).classList.add('show');
        };
        
        window.checkShortAnswer = function(questionIndex, acceptPattern) {
            const input = document.getElementById(`quiz-input-${questionIndex}`);
            const answer = input.value.trim().toLowerCase();
            const accepted = acceptPattern.toLowerCase().split('|');
            
            if (accepted.some(a => answer.includes(a))) {
                input.style.borderColor = 'var(--ok)';
                input.style.background = 'rgba(100, 200, 100, 0.1)';
            } else {
                input.style.borderColor = 'var(--danger)';
                input.style.background = 'rgba(200, 100, 100, 0.1)';
            }
            
            document.getElementById(`explanation-${questionIndex}`).classList.add('show');
        };
        
        // Render Practice Mode
        function renderPracticeMode(problem) {
            if (!problem.practice) {
                return '<p>No practice available for this problem.</p>';
            }
            
            return `
                <div class="learning-mode active">
                    <div class="learn-section">
                        <h3>📋 Problem Requirements</h3>
                        <p><strong>Constraints:</strong> ${problem.practice.constraints}</p>
                        <p><strong>Expected Complexity:</strong> ${problem.practice.expectedComplexity}</p>
                    </div>
                    
                    <div class="learn-section">
                        <h3>💻 Code Editor</h3>
                        <div id="code-editor" class="practice-editor">${problem.practice.starter || ''}</div>
                        <div style="margin-top: 15px;">
                            <button onclick="window.runCode()" class="run-btn">
                                ▶ Run Code
                            </button>
                            <button onclick="window.showSolution()" style="
                                padding: 12px 24px;
                                background: var(--border);
                                color: var(--text);
                                border: none;
                                border-radius: 6px;
                                cursor: pointer;
                                font-size: 14px;
                            ">Show Solution</button>
                        </div>
                    </div>
                    
                    <div class="test-cases">
                        <h3>🧪 Test Cases</h3>
                        <div id="test-results">
                            ${problem.practice.tests ? problem.practice.tests.map((test, i) => `
                                <div class="test-case" id="test-${i}">
                                    <div>
                                        <strong>Test ${i + 1}:</strong>
                                        Input: ${JSON.stringify(test.input)}
                                    </div>
                                    <div>
                                        Expected: ${JSON.stringify(test.expected)}
                                    </div>
                                </div>
                            `).join('') : 'No test cases available.'}
                        </div>
                    </div>
                    
                    <div class="output-console" id="console-output">
                        <div class="output-line info">Ready to run your code...</div>
                    </div>
                    
                    <div id="solution-section" style="display: none;">
                        <div class="learn-section" style="margin-top: 20px;">
                            <h3>✅ Optimal Solution</h3>
                            <div class="code-template">
                                <button class="copy-btn" onclick="navigator.clipboard.writeText(this.nextElementSibling.textContent)">
                                    Copy
                                </button>
                                <pre>${problem.practice.optimal || 'No solution provided.'}</pre>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // Initialize CodeMirror editor
        let editor = null;
        function initializeCodeEditor() {
            setTimeout(() => {
                const editorElement = document.getElementById('code-editor');
                if (editorElement && !editor) {
                    editor = CodeMirror(function(elt) {
                        editorElement.parentNode.replaceChild(elt, editorElement);
                    }, {
                        value: editorElement.textContent,
                        mode: 'javascript',
                        theme: 'monokai',
                        lineNumbers: true,
                        indentUnit: 2,
                        tabSize: 2,
                        lineWrapping: true
                    });
                } else if (editor) {
                    editor.setValue(state.currentProblem.practice.starter || '');
                }
            }, 100);
        }
        
        // Run code
        window.runCode = function() {
            const problem = state.currentProblem;
            if (!problem.practice || !editor) return;
            
            const code = editor.getValue();
            const console = document.getElementById('console-output');
            console.innerHTML = '<div class="output-line info">Running tests...</div>';
            
            try {
                // Create function from user code
                const func = new Function('return ' + code)();
                
                // Run tests
                let passed = 0;
                problem.practice.tests.forEach((test, i) => {
                    try {
                        const result = func(...test.input);
                        const testDiv = document.getElementById(`test-${i}`);
                        
                        if (JSON.stringify(result) === JSON.stringify(test.expected)) {
                            testDiv.classList.add('pass');
                            testDiv.classList.remove('fail');
                            console.innerHTML += `<div class="output-line success">✓ Test ${i + 1} passed</div>`;
                            passed++;
                        } else {
                            testDiv.classList.add('fail');
                            testDiv.classList.remove('pass');
                            console.innerHTML += `<div class="output-line error">✗ Test ${i + 1} failed: Got ${JSON.stringify(result)}, expected ${JSON.stringify(test.expected)}</div>`;
                        }
                    } catch (e) {
                        document.getElementById(`test-${i}`).classList.add('fail');
                        console.innerHTML += `<div class="output-line error">✗ Test ${i + 1} error: ${e.message}</div>`;
                    }
                });
                
                if (passed === problem.practice.tests.length) {
                    console.innerHTML += `<div class="output-line success">🎉 All tests passed! Great job!</div>`;
                    markCompleted(state.currentTopic.id, problem.id);
                }
            } catch (e) {
                console.innerHTML = `<div class="output-line error">Syntax Error: ${e.message}</div>`;
            }
        };
        
        // Show solution
        window.showSolution = function() {
            document.getElementById('solution-section').style.display = 'block';
            document.getElementById('solution-section').scrollIntoView({ behavior: 'smooth' });
        };
        
        // Render Game Mode
        async function renderGameMode(problem, container) {
            if (!problem.game) {
                container.innerHTML = '<p>No game available for this problem.</p>';
                return;
            }
            
            // Create a container for the game
            const gameContainer = document.createElement('div');
            gameContainer.className = 'learning-mode active';
            
            // Import the games module and render the game
            try {
                const { renderGame } = await import('./src/modules/games.js');
                const { State } = await import('./src/modules/state.js');
                
                // Load state using the State module
                const gameState = State.load();
                
                // Get current topic from state
                const currentTopic = state.currentTopic || { id: 'arrays', title: 'Arrays' };
                
                // Append the game container to the provided container
                container.appendChild(gameContainer);
                
                // Render the game directly into the container (this preserves event handlers)
                renderGame(gameContainer, gameState, currentTopic, problem);
                
            } catch (error) {
                console.error('Failed to load game:', error);
                container.innerHTML = `
                    <div class="learning-mode active">
                        <div class="learn-section">
                            <h3>Interactive Game: ${problem.game.type}</h3>
                            <p style="color: var(--error);">Failed to load game: ${error.message}</p>
                        </div>
                    </div>
                `;
            }
        }
        
        // Show Algorithm Visualization
        window.showVisualization = async function(problemId) {
            const container = document.getElementById('algorithm-visualizer');
            if (!container) return;
            
            try {
                const { Visualizers } = await import('./src/modules/visualizer.js');
                
                // Map problem IDs to appropriate visualizations
                const visualizationMap = {
                    'two-sum': () => Visualizers.twoPointers(container, [1, 2, 3, 4, 5, 7, 9], 10),
                    'container-water': () => Visualizers.twoPointers(container, [1, 8, 6, 2, 5, 4, 8, 3, 7], 15),
                    'sliding-window-max': () => Visualizers.slidingWindow(container, [2, 1, 5, 1, 3, 2], 3),
                    'binary-search': () => Visualizers.binarySearch(container, [1, 3, 5, 7, 9, 11, 13, 15, 17], 7),
                    'tree-bfs': () => Visualizers.binaryTree(container, 'bfs'),
                    'tree-dfs': () => Visualizers.binaryTree(container, 'dfs'),
                    'bubble-sort': () => Visualizers.bubbleSort(container, [64, 34, 25, 12, 22, 11, 90]),
                    'merge-sort': () => Visualizers.mergeSort ? Visualizers.mergeSort(container, [64, 34, 25, 12, 22, 11, 90]) : null,
                    'fibonacci': () => Visualizers.fibonacci(container, 10),
                    'graph-dfs': () => Visualizers.dfs(container),
                    'graph-bfs': () => Visualizers.bfs ? Visualizers.bfs(container) : null,
                };
                
                // Try to find a matching visualization
                let visualizer = null;
                for (const [key, createViz] of Object.entries(visualizationMap)) {
                    if (problemId.includes(key) || key.includes(problemId.split('-')[0])) {
                        visualizer = createViz();
                        break;
                    }
                }
                
                // If no specific match, try to determine by problem type
                if (!visualizer && state.currentProblem) {
                    const problem = state.currentProblem;
                    if (problem.title.toLowerCase().includes('two pointer') || 
                        problem.title.toLowerCase().includes('two sum')) {
                        visualizer = Visualizers.twoPointers(container, [1, 3, 5, 7, 9, 11], 12);
                    } else if (problem.title.toLowerCase().includes('sliding window')) {
                        visualizer = Visualizers.slidingWindow(container, [1, 3, -1, -3, 5, 3, 6, 7], 3);
                    } else if (problem.title.toLowerCase().includes('binary search')) {
                        visualizer = Visualizers.binarySearch(container, [1, 2, 3, 4, 5, 6, 7, 8, 9], 5);
                    } else if (problem.title.toLowerCase().includes('tree') && 
                              problem.title.toLowerCase().includes('bfs')) {
                        visualizer = Visualizers.binaryTree(container, 'bfs');
                    } else if (problem.title.toLowerCase().includes('sort')) {
                        visualizer = Visualizers.bubbleSort(container, [5, 2, 8, 1, 9, 3]);
                    } else if (problem.title.toLowerCase().includes('fibonacci') ||
                              problem.title.toLowerCase().includes('dp')) {
                        visualizer = Visualizers.fibonacci(container, 8);
                    } else if (problem.title.toLowerCase().includes('graph')) {
                        visualizer = Visualizers.dfs(container);
                    }
                }
                
                if (!visualizer) {
                    // Default visualization
                    container.innerHTML = `
                        <div style="padding: 20px; text-align: center; color: var(--muted);">
                            <p>Select from available visualizations:</p>
                            <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; margin-top: 20px;">
                                <button class="viz-btn" onclick="window.showSpecificVisualization('twoPointers')">Two Pointers</button>
                                <button class="viz-btn" onclick="window.showSpecificVisualization('slidingWindow')">Sliding Window</button>
                                <button class="viz-btn" onclick="window.showSpecificVisualization('binarySearch')">Binary Search</button>
                                <button class="viz-btn" onclick="window.showSpecificVisualization('bfs')">Tree BFS</button>
                                <button class="viz-btn" onclick="window.showSpecificVisualization('bubbleSort')">Bubble Sort</button>
                                <button class="viz-btn" onclick="window.showSpecificVisualization('fibonacci')">Fibonacci DP</button>
                                <button class="viz-btn" onclick="window.showSpecificVisualization('dfs')">Graph DFS</button>
                            </div>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Failed to load visualization:', error);
                container.innerHTML = `<p style="color: var(--error);">Failed to load visualization: ${error.message}</p>`;
            }
        };
        
        // Show specific visualization
        window.showSpecificVisualization = async function(type) {
            const container = document.getElementById('algorithm-visualizer');
            if (!container) return;
            
            try {
                const { Visualizers } = await import('./src/modules/visualizer.js');
                
                switch(type) {
                    case 'twoPointers':
                        Visualizers.twoPointers(container, [1, 2, 3, 4, 5, 7, 9], 10);
                        break;
                    case 'slidingWindow':
                        Visualizers.slidingWindow(container, [2, 1, 5, 1, 3, 2], 3);
                        break;
                    case 'binarySearch':
                        Visualizers.binarySearch(container, [1, 3, 5, 7, 9, 11, 13, 15], 9);
                        break;
                    case 'bfs':
                        Visualizers.binaryTree(container, 'bfs');
                        break;
                    case 'bubbleSort':
                        Visualizers.bubbleSort(container, [64, 34, 25, 12, 22, 11, 90]);
                        break;
                    case 'fibonacci':
                        Visualizers.fibonacci(container, 10);
                        break;
                    case 'dfs':
                        Visualizers.dfs(container);
                        break;
                }
            } catch (error) {
                console.error('Failed to load visualization:', error);
            }
        };
        
        // Make renderTopic available globally
        window.renderTopic = function(topicId) {
            const topic = fullContent.topics.find(t => t.id === topicId);
            if (topic) renderTopic(topic);
        };
        
        // Make markCompleted available globally
        window.markCompleted = markCompleted;
        
        // Initialize after content is loaded
        async function initialize() {
            console.log('Initializing with topics:', fullContent?.topics?.length);
            renderSidebar();
            updateStats();
            
            // Reset button
            document.getElementById('resetProgressBtn').onclick = () => {
                if (confirm('Reset all progress? This cannot be undone.')) {
                    state.progress = {};
                    saveProgress();
                    renderSidebar();
                    location.reload();
                }
            };
            
            // Start Path button - Suggests next problem based on difficulty
            document.getElementById('startPathBtn').onclick = async () => {
                const { nextByDifficulty } = await import('./src/modules/scheduler.js');
                const next = nextByDifficulty(state, fullContent);
                
                if (next) {
                    // Find the topic and item
                    const topic = fullContent.topics.find(t => t.id === next.topicId);
                    const item = topic.items.find(i => i.id === next.itemId);
                    
                    // Navigate to that problem
                    state.currentTopic = topic;
                    state.currentProblem = item;
                    state.currentMode = 'learn';
                    
                    renderTopic(topic);
                    renderProblem(item);
                    
                    // Show a message
                    const main = document.getElementById('main');
                    const message = document.createElement('div');
                    message.style.cssText = `
                        position: fixed;
                        top: 80px;
                        right: 20px;
                        background: var(--accent);
                        color: white;
                        padding: 15px 20px;
                        border-radius: 8px;
                        z-index: 1000;
                        animation: slideIn 0.3s ease;
                    `;
                    message.innerHTML = `
                        <strong>Learning Path</strong><br>
                        Next problem: ${item.title}<br>
                        Difficulty: ${item.difficulty || 'medium'}
                    `;
                    document.body.appendChild(message);
                    setTimeout(() => message.remove(), 3000);
                } else {
                    alert('Congratulations! You have completed all available problems.');
                }
            };
            
            // Review Queue button - Shows problems due for review
            document.getElementById('reviewQueueBtn').onclick = async () => {
                const { pickNextForReview } = await import('./src/modules/scheduler.js');
                
                // Create review queue modal
                const modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(0,0,0,0.8);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 2000;
                `;
                
                const content = document.createElement('div');
                content.style.cssText = `
                    background: var(--bg-secondary);
                    padding: 30px;
                    border-radius: 12px;
                    max-width: 600px;
                    max-height: 80vh;
                    overflow-y: auto;
                `;
                
                // Get all items for review
                const reviewItems = [];
                const now = Date.now();
                
                for (const topic of fullContent.topics) {
                    const tprog = state.progress[topic.id];
                    if (!tprog) continue;
                    
                    for (const item of topic.items) {
                        const it = (tprog.items || {})[item.id];
                        if (!it) continue;
                        
                        const daysOld = Math.floor((now - (it.last || 0)) / (24 * 3600 * 1000));
                        if (it.learnDone || it.quizScore > 0 || it.codePassed) {
                            reviewItems.push({
                                topic: topic,
                                item: item,
                                progress: it,
                                daysOld: daysOld,
                                due: it.due || 0
                            });
                        }
                    }
                }
                
                // Sort by due date
                reviewItems.sort((a, b) => a.due - b.due);
                
                content.innerHTML = `
                    <h2>Review Queue</h2>
                    <p style="color: var(--muted); margin-bottom: 20px;">
                        ${reviewItems.length} items in your review queue
                    </p>
                    <div style="display: flex; flex-direction: column; gap: 10px;">
                        ${reviewItems.length > 0 ? reviewItems.slice(0, 10).map(r => `
                            <div style="
                                background: var(--bg);
                                padding: 15px;
                                border-radius: 8px;
                                cursor: pointer;
                                transition: transform 0.2s;
                            " onmouseover="this.style.transform='scale(1.02)'" 
                               onmouseout="this.style.transform='scale(1)'"
                               onclick="
                                   window.state.currentTopic = window.fullContent.topics.find(t => t.id === '${r.topic.id}');
                                   window.state.currentProblem = window.state.currentTopic.items.find(i => i.id === '${r.item.id}');
                                   window.state.currentMode = '${r.progress.codePassed ? 'quiz' : 'practice'}';
                                   window.renderTopic(window.state.currentTopic);
                                   window.renderProblem(window.state.currentProblem);
                                   this.parentElement.parentElement.parentElement.remove();
                               ">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <strong>${r.item.title}</strong>
                                        <div style="font-size: 12px; color: var(--muted); margin-top: 5px;">
                                            ${r.topic.title} • Last reviewed ${r.daysOld} days ago
                                        </div>
                                    </div>
                                    <div style="text-align: right;">
                                        <div style="font-size: 12px; color: var(--accent);">
                                            ${r.due <= now ? 'Due now' : `Due in ${Math.ceil((r.due - now) / (24 * 3600 * 1000))} days`}
                                        </div>
                                        <div style="font-size: 10px; color: var(--muted); margin-top: 3px;">
                                            Quiz: ${Math.round((r.progress.quizScore || 0) * 100)}% • 
                                            Code: ${r.progress.codePassed ? '✓' : '✗'}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `).join('') : `
                            <p style="text-align: center; color: var(--muted); padding: 40px;">
                                No items for review yet. Complete some problems first!
                            </p>
                        `}
                    </div>
                    <button style="
                        margin-top: 20px;
                        padding: 10px 20px;
                        background: var(--accent);
                        color: white;
                        border: none;
                        border-radius: 6px;
                        cursor: pointer;
                        width: 100%;
                    " onclick="this.parentElement.parentElement.remove()">
                        Close
                    </button>
                `;
                
                modal.appendChild(content);
                document.body.appendChild(modal);
                
                // Close on backdrop click
                modal.onclick = (e) => {
                    if (e.target === modal) modal.remove();
                };
            };
            
            // Lab button - Open DSA Lab for experimenting
            document.getElementById('labBtn').onclick = async () => {
                const { renderLab } = await import('./src/modules/lab.js');
                const main = document.getElementById('main');
                main.innerHTML = '';
                renderLab(main);
                
                // Update state
                state.currentMode = 'lab';
                
                // Add back button
                const backBtn = document.createElement('button');
                backBtn.textContent = '← Back to Problems';
                backBtn.style.cssText = `
                    margin: 20px;
                    padding: 10px 20px;
                    background: var(--border);
                    color: var(--text);
                    border: none;
                    border-radius: 6px;
                    cursor: pointer;
                `;
                backBtn.onclick = () => {
                    if (state.currentTopic) {
                        renderTopic(state.currentTopic);
                    } else {
                        main.innerHTML = `
                            <div id="welcome-screen" style="padding: 20px; text-align: center;">
                                <h1>Welcome to DSA Learner</h1>
                                <p>Select a topic from the sidebar to begin your journey!</p>
                            </div>
                        `;
                    }
                };
                main.insertBefore(backBtn, main.firstChild);
            };
            
            // Update coach
            const coachContent = document.getElementById('coach-content');
            coachContent.innerHTML += `
                <div style="margin-top: 15px;">
                    <h4 style="font-size: 14px;">Quick Tips:</h4>
                    <ul style="font-size: 12px; color: var(--muted); padding-left: 20px;">
                        <li>Start with easy problems</li>
                        <li>Read hints before looking at solutions</li>
                        <li>Practice daily for best results</li>
                        <li>Review completed problems regularly</li>
                    </ul>
                </div>
            `;
        }
        
        // Initialize when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initialize);
        } else {
            initialize();
        }
    </script>
</body>
</html>